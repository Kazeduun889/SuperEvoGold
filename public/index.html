<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Evo Gold</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #0f0f13;
            --card-bg: #1c1c24;
            --primary: #f1c40f; /* Gold */
            --accent: #3498db;
            --text: #ffffff;
            --secondary-text: #888899;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Balance Card */
        .balance-card {
            background: linear-gradient(145deg, #252530, #18181f);
            width: 100%;
            max-width: 350px;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .balance-label { color: var(--secondary-text); font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .balance-amount { font-size: 42px; font-weight: 800; color: var(--primary); margin: 10px 0; text-shadow: 0 0 10px rgba(241, 196, 15, 0.3); }
        .currency { font-size: 20px; color: #fff; }

        /* Buttons */
        .btn {
            width: 100%;
            max-width: 350px;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { 
            background: linear-gradient(90deg, #3498db, #2980b9); 
            color: white; 
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }
        .btn-withdraw { 
            background: linear-gradient(90deg, #f39c12, #d35400); 
            color: white; 
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
        }
        .btn-admin {
            background: #e74c3c;
            color: white;
            margin-top: 20px;
            display: none; /* –°–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
        
        .input-group {
            width: 100%;
            max-width: 350px;
            margin-bottom: 10px;
        }
        input {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            background: var(--card-bg);
            border: 1px solid #333;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
            outline: none;
        }
        input:focus { border-color: var(--accent); }

        /* Timer & Popups */
        #timer { color: var(--secondary-text); margin-bottom: 15px; font-size: 14px; display: none; }
        .loader { width: 20px; height: 20px; border: 3px solid #FFF; border-bottom-color: transparent; border-radius: 50%; animation: rotation 1s linear infinite; display: none; }
        
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Admin Modal */
        #adminPanel {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .stat-box { text-align: left; background: #222; padding: 20px; border-radius: 10px; width: 80%; }
        .close-btn { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer; }

    </style>
</head>
<body>

    <div class="balance-card">
        <div class="balance-label">–¢–≤–æ–π –±–∞–ª–∞–Ω—Å</div>
        <div class="balance-amount"><span id="balance">0.0</span> <span class="currency">G</span></div>
    </div>

    <!-- –ë–ª–æ–∫ –∑–∞—Ä–∞–±–æ—Ç–∫–∞ -->
    <div id="timer">‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏... <span id="timeLeft">15</span> —Å–µ–∫</div>
    <button class="btn btn-primary" id="adBtn" onclick="watchAd()">
        üåê –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–∞–π—Ç–æ–≤ (+1.0-1.5 G)
    </button>

    <hr style="width: 100%; max-width: 350px; border-color: #333; margin: 25px 0;">

    <!-- –ë–ª–æ–∫ –≤—ã–≤–æ–¥–∞ -->
    <div class="input-group">
        <input type="text" id="gameId" placeholder="–í–≤–µ–¥–∏ —Å–≤–æ–π ID (Project Evo)">
    </div>
    <button class="btn btn-withdraw" onclick="withdraw()">
        <span class="loader" id="wLoader"></span>
        <span id="wText">üì§ –í—ã–≤–µ—Å—Ç–∏ –≤ –∏–≥—Ä—É</span>
    </button>
    <div style="font-size: 12px; color: #666; margin-top: 5px;">–ú–∏–Ω–∏–º—É–º: <span id="minLimit">1000</span> G</div>

    <!-- –°–∫—Ä—ã—Ç–∞—è –∫–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞ -->
    <button class="btn btn-admin" id="adminBtn" onclick="openAdmin()">üëÆ –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª—å</button>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –ê–¥–º–∏–Ω–∞ -->
    <div id="adminPanel">
        <div class="close-btn" onclick="document.getElementById('adminPanel').style.display='none'">&times;</div>
        <h2 style="color: #fff">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <div class="stat-box">
            <p>üë• –ò–≥—Ä–æ–∫–æ–≤: <span id="statUsers" style="color: #3498db">...</span></p>
            <p>üí∞ –î–æ–ª–≥ –ø—Ä–æ–µ–∫—Ç–∞: <span id="statDebt" style="color: #f1c40f">...</span> G</p>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // –°–Æ–î–ê –í–°–¢–ê–í–¨ –°–°–´–õ–ö–£ MONETAG
        const MONETAG_LINK = 'https://—Ç–≤–æ—è-—Å—Å—ã–ª–∫–∞.com'; 

        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 0;
        const API_URL = ''; // –û—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º

        let isWorking = false;

        async function init() {
            if (userId === 0) {
                document.getElementById('balance').innerText = 'ERROR';
                return tg.showAlert('–ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ –¢–µ–ª–µ–≥—Ä–∞–º!');
            }

            try {
                const res = await fetch(`${API_URL}/api/user/${userId}`);
                const data = await res.json();
                
                document.getElementById('balance').innerText = data.balance;
                document.getElementById('minLimit').innerText = data.minWithdraw;

                // –ï—Å–ª–∏ –∞–¥–º–∏–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å
                if (data.isAdmin) {
                    document.getElementById('adminBtn').style.display = 'block';
                }
            } catch (e) {
                tg.showAlert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }

        function watchAd() {
            if (isWorking) return;
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∫–ª–∞–º—É
            window.open(MONETAG_LINK, '_blank');
            
            const btn = document.getElementById('adBtn');
            const timerDiv = document.getElementById('timer');
            const timeLeftSpan = document.getElementById('timeLeft');
            
            isWorking = true;
            btn.style.opacity = '0.5';
            btn.disabled = true;
            timerDiv.style.display = 'block';
            let timeLeft = 15; // –í—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

            const interval = setInterval(() => {
                timeLeft--;
                timeLeftSpan.innerText = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(interval);
                    claimReward();
                    
                    isWorking = false;
                    btn.style.opacity = '1';
                    btn.disabled = false;
                    timerDiv.style.display = 'none';
                    timeLeft = 15;
                }
            }, 1000);
        }

        async function claimReward() {
            try {
                const res = await fetch(`${API_URL}/api/reward`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId })
                });
                const data = await res.json();
                
                if (data.success) {
                    document.getElementById('balance').innerText = data.newBalance;
                    tg.HapticFeedback.notificationOccurred('success'); // –í–∏–±—Ä–∞—Ü–∏—è
                    tg.showAlert(`‚úÖ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: +${data.reward} G`);
                }
            } catch (e) {
                tg.showAlert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            }
        }

        async function withdraw() {
            const gameId = document.getElementById('gameId').value;
            if (!gameId) return tg.showAlert('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à ID –∏–∑ –∏–≥—Ä—ã!');

            const btnText = document.getElementById('wText');
            const loader = document.getElementById('wLoader');
            
            btnText.style.display = 'none';
            loader.style.display = 'inline-block';

            try {
                const res = await fetch(`${API_URL}/api/withdraw`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, gameId })
                });
                const data = await res.json();

                if (data.success) {
                    tg.showAlert('‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω—É!');
                    init(); // –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å
                } else {
                    tg.showAlert(`‚ùå –û—à–∏–±–∫–∞: ${data.message}`);
                }
            } catch (e) {
                tg.showAlert('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
            } finally {
                btnText.style.display = 'inline';
                loader.style.display = 'none';
            }
        }

        async function openAdmin() {
            document.getElementById('adminPanel').style.display = 'flex';
            const res = await fetch(`${API_URL}/api/admin/stats`);
            const data = await res.json();
            document.getElementById('statUsers').innerText = data.users;
            document.getElementById('statDebt').innerText = data.debt;
        }

        init();
    </script>
</body>
</html>